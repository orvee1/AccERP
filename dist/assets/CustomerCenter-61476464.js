import{c as Z,u as H,r as n,j as e,B as k}from"./index-fe6d2e52.js";import{I as w}from"./input-e5a38bac.js";import{D as J,a as V,b as G,c as K,d as Y,e as M,f as Q,g as R,h as z,i as W,j as X,A as _,k as E,l as ee,m as re,n as ae,o as te,p as se,q as oe}from"./alert-dialog-e8612541.js";import{L as S}from"./label-1a727cef.js";import{D as ne}from"./date-picker-3c1e787d.js";import{S as P}from"./save-39dd484b.js";import{C as de,a as le,b as ce,c as ie}from"./card-00c50818.js";import{P as me}from"./plus-circle-ee65b1db.js";import{S as ue,P as pe,A as xe}from"./search-c0fd07d3.js";import{T as ge}from"./trash-2-fd25eb8f.js";import"./extends-b7a1e135.js";const he=Z("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),be=({onSave:c,onCancel:m,initialData:s,isEditMode:a})=>{const{toast:u}=H(),[o,g]=n.useState(""),[j,b]=n.useState(""),[f,N]=n.useState(""),[B,h]=n.useState(""),[x,C]=n.useState(""),[v,y]=n.useState(void 0),[D,A]=n.useState(null);n.useEffect(()=>{var t;a&&s?(g(s.name||""),b(s.proprietorName||""),N(s.customerNumber||""),h(s.address||""),C(((t=s.openingBalance)==null?void 0:t.toString())||""),y(s.openingBalanceDate?new Date(s.openingBalanceDate):void 0),A(s.id||s.customerNumber)):O()},[s,a]);const O=()=>{g(""),b(""),N(""),h(""),C(""),y(void 0),A(null)},F=(t,T=!0)=>{if(t.preventDefault(),!o){u({title:"Validation Error",description:"Customer Name is required.",variant:"destructive"});return}const I={id:D||`cust-${Date.now()}`,name:o,proprietorName:j,customerNumber:f||(D?D.split("-")[1]||String(Date.now()).slice(-4):`C${String(Date.now()).slice(-4)}`),address:B,openingBalance:parseFloat(x)||0,openingBalanceDate:v?v.toISOString().split("T")[0]:null};c(I,a),u({title:`Customer ${a?"Updated":"Saved"}!`,description:`${o} has been successfully ${a?"updated":"added"}.`}),T?m():a||O()};return e.jsxs("form",{onSubmit:t=>F(t,!0),className:"space-y-4 py-2",children:[e.jsxs(J,{className:"hidden",children:[e.jsx(V,{children:a?"Edit Customer":"Add New Customer"}),e.jsx(G,{children:a?"Update customer details.":"Fill in the details to add a new customer."})]}),e.jsxs("div",{children:[e.jsxs(S,{htmlFor:"customerName",children:["Customer Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(w,{id:"customerName",value:o,onChange:t=>g(t.target.value),placeholder:"e.g., Client Omega Corp.",className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"proprietorName",children:"Proprietor Name"}),e.jsx(w,{id:"proprietorName",value:j,onChange:t=>b(t.target.value),placeholder:"e.g., Jane Smith",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"customerNumber",children:"Customer Number"}),e.jsx(w,{id:"customerNumber",value:f,onChange:t=>N(t.target.value),placeholder:"e.g., C001",className:"mt-1",disabled:a}),a&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Customer number cannot be changed after creation."})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"address",children:"Address"}),e.jsx(w,{id:"address",value:B,onChange:t=>h(t.target.value),placeholder:"e.g., 456 Client Ave",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"openingBalance",children:"Opening Balance"}),e.jsx(w,{id:"openingBalance",type:"number",value:x,onChange:t=>C(t.target.value),placeholder:"0.00",className:"mt-1",disabled:a}),a&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening balance cannot be changed after creation."})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"openingBalanceDate",children:"Opening Balance As of Date"}),e.jsx(ne,{date:v,setDate:y,className:"mt-1 w-full",disabled:a}),a&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening balance date cannot be changed after creation."})]}),e.jsxs(K,{className:"pt-6",children:[e.jsx(Y,{asChild:!0,children:e.jsx(k,{variant:"outline",onClick:m,children:"Cancel"})}),!a&&e.jsxs(k,{type:"button",onClick:t=>F(t,!1),variant:"secondary",children:[e.jsx(P,{size:18,className:"mr-2"})," Save & New"]}),e.jsxs(k,{type:"submit",children:[e.jsx(P,{size:18,className:"mr-2"})," ",a?"Update Customer":"Save & Close"]})]})]})},U=[{id:"cust-001",name:"Client Omega Corp.",proprietorName:"Mr. O",customerNumber:"C001",address:"123 Omega St",balance:2800,openingBalance:2800,openingBalanceDate:"2023-01-01"},{id:"cust-002",name:"Customer Zeta Ltd.",proprietorName:"Ms. Z",customerNumber:"C002",address:"456 Zeta Ave",balance:0,openingBalance:0,openingBalanceDate:"2023-01-01"},{id:"cust-003",name:"Patron Gamma Solutions",proprietorName:"Dr. G",customerNumber:"C003",address:"789 Gamma Rd",balance:5120.75,openingBalance:5120.75,openingBalanceDate:"2023-01-01"},{id:"cust-004",name:"Client Alpha Services",proprietorName:"Prof. A",customerNumber:"C004",address:"012 Alpha Blvd",balance:-300,openingBalance:-300,openingBalanceDate:"2023-01-01"}],$=c=>({...c,balanceFormatted:`${(c.balance||0).toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})} ${(c.balance||0)>=0?"(Receivable)":"(Payable)"}`}),q=({children:c,columnKey:m,sortConfig:s,requestSort:a,isTextRight:u=!1,className:o=""})=>{const g=s&&s.key===m,j=g?s.direction:null;return e.jsx("th",{scope:"col",className:`px-4 py-3 cursor-pointer hover:bg-primary/10 dark:hover:bg-dark-primary/10 transition-colors ${u?"text-right":"text-left"} ${o}`,onClick:()=>a(m),children:e.jsxs("div",{className:`flex items-center ${u?"justify-end":"justify-start"}`,children:[!u&&c,e.jsx("span",{className:`mx-1 ${u?"mr-0 ml-1":"ml-0 mr-1"}`,children:g?j==="ascending"?"▲":"▼":e.jsx(xe,{size:14,className:"opacity-40"})}),u&&c]})})},Ae=()=>{const{toast:c}=H(),[m,s]=n.useState(()=>U.map($)),[a,u]=n.useState(""),[o,g]=n.useState({key:"name",direction:"ascending"}),[j,b]=n.useState(!1),[f,N]=n.useState(null),[B,h]=n.useState(!1),[x,C]=n.useState(null);n.useEffect(()=>{const r=localStorage.getItem("customers");r?s(JSON.parse(r).map($)):localStorage.setItem("customers",JSON.stringify(U))},[]);const v=r=>{localStorage.setItem("customers",JSON.stringify(r.map(({balanceFormatted:d,...p})=>p)))},y=(r=null)=>{N(r),b(!0)},D=()=>{b(!1),N(null)},A=(r,d)=>{s(p=>{let l;if(d)l=p.map(i=>i.id===r.id?$({...i,...r,balance:r.openingBalance}):i);else{const i=$({...r,balance:r.openingBalance});l=[...p,i]}return v(l),l})},O=r=>{const d=m.find(p=>p.id===r);d&&(C(d),h(!0))},F=()=>{if(x){const r=m.filter(d=>d.id!==x.id);s(r),v(r),c({title:"Customer Deleted",description:`${x.name} has been deleted.`,variant:"destructive"}),h(!1),C(null)}},t=()=>{c({title:"Import Customers from Excel",description:"This feature will be available soon.",duration:3e3})},T=r=>u(r.target.value),I=r=>{let d="ascending";o&&o.key===r&&o.direction==="ascending"&&(d="descending"),g({key:r,direction:d})},L=n.useMemo(()=>{let r=[...m];if(a){const d=a.toLowerCase();r=r.filter(p=>Object.values(p).some(l=>String(l).toLowerCase().includes(d)))}return o!==null&&r.sort((d,p)=>{let l=d[o.key],i=p[o.key];return o.key==="balance"?(l=parseFloat(l)||0,i=parseFloat(i)||0):typeof l=="string"&&(l=l.toLowerCase(),i=i.toLowerCase()),l<i?o.direction==="ascending"?-1:1:l>i?o.direction==="ascending"?1:-1:0}),r},[a,o,m]);return e.jsx("div",{className:"space-y-6 p-1",children:e.jsxs(de,{className:"shadow-lg border-border dark:border-dark-border",children:[e.jsx(le,{className:"bg-card dark:bg-dark-card rounded-t-lg p-4 md:p-6 border-b border-border dark:border-dark-border",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsxs(ce,{className:"text-2xl md:text-3xl font-bold text-primary dark:text-dark-primary flex items-center",children:[e.jsx(he,{size:28,className:"mr-3 text-accent dark:text-dark-accent"})," Customer Center"]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(M,{children:[e.jsx(Q,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:"text-primary dark:text-dark-primary border-primary dark:border-dark-primary hover:bg-primary/10 dark:hover:bg-dark-primary/10 shadow-sm",children:[e.jsx(me,{size:20,className:"mr-2"})," Add Customer"]})}),e.jsxs(R,{align:"end",className:"bg-card dark:bg-dark-card shadow-lg rounded-md border border-border dark:border-dark-border",children:[e.jsx(z,{onClick:()=>y(null),className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Add New"}),e.jsx(z,{onClick:t,className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Import from Excel"})]})]})})]})}),e.jsxs(ie,{className:"p-4 md:p-6",children:[e.jsx(W,{open:j,onOpenChange:b,children:e.jsxs(X,{className:"sm:max-w-[550px] bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground border-border dark:border-dark-border shadow-2xl rounded-lg",children:[e.jsxs(J,{children:[e.jsx(V,{className:"text-primary dark:text-dark-primary text-2xl font-semibold",children:f?"Edit Customer":"Add New Customer"}),e.jsx(G,{className:"text-muted-foreground dark:text-dark-muted-foreground",children:f?"Update customer details.":"Fill in the details to add a new customer."})]}),e.jsx(be,{onSave:A,onCancel:D,initialData:f,isEditMode:!!f})]})}),e.jsx(_,{open:B,onOpenChange:h,children:e.jsxs(E,{children:[e.jsxs(ee,{children:[e.jsx(re,{children:"Are you absolutely sure?"}),e.jsxs(ae,{children:['This action cannot be undone. This will permanently delete the customer "',x==null?void 0:x.name,'".']})]}),e.jsxs(te,{children:[e.jsx(se,{onClick:()=>h(!1),children:"Cancel"}),e.jsx(oe,{onClick:F,className:"bg-destructive hover:bg-destructive/90",children:"Yes, delete customer"})]})]})}),e.jsxs("div",{className:"mb-6 flex items-center space-x-2 p-3 bg-background dark:bg-dark-background rounded-lg shadow-sm border border-border dark:border-dark-border",children:[e.jsx(w,{type:"text",placeholder:"Search customers (Name, Balance...)",className:"flex-grow focus:ring-accent dark:focus:ring-dark-accent border-input dark:border-dark-input focus:border-primary dark:focus:border-dark-primary",value:a,onChange:T}),e.jsxs(k,{className:"bg-primary text-primary-foreground hover:bg-primary-hover dark:bg-dark-primary dark:text-dark-primary-foreground dark:hover:bg-dark-primary-hover",onClick:()=>c({title:"Search Updated",description:`Displaying results for "${a}"`}),children:[e.jsx(ue,{size:18,className:"mr-2"})," Search"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-border dark:border-dark-border shadow-md",children:e.jsxs("table",{className:"w-full min-w-[600px] text-sm text-left text-foreground dark:text-dark-foreground",children:[e.jsx("thead",{className:"text-xs text-primary dark:text-dark-primary uppercase bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx(q,{columnKey:"name",sortConfig:o,requestSort:I,className:"min-w-[250px]",children:"Customer Name"}),e.jsx(q,{columnKey:"balance",sortConfig:o,requestSort:I,isTextRight:!0,children:"Balance"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center w-28",children:"Actions"})]})}),e.jsxs("tbody",{children:[L.map(r=>e.jsxs("tr",{className:"bg-card dark:bg-dark-card border-b border-border dark:border-dark-border last:border-b-0 hover:bg-muted/30 dark:hover:bg-dark-muted/30 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-secondary dark:text-dark-secondary hover:underline cursor-pointer",onClick:()=>c({title:`View Ledger: ${r.name}`,description:"Detailed customer ledger view coming soon."}),children:r.name}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:r.balanceFormatted}),e.jsxs("td",{className:"px-4 py-3 text-center space-x-1",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"text-secondary dark:text-dark-secondary hover:text-accent dark:hover:text-dark-accent h-8 w-8",onClick:()=>y(r),children:e.jsx(pe,{size:16})}),e.jsx(k,{variant:"ghost",size:"icon",className:"text-destructive dark:text-red-400 hover:text-destructive/80 dark:hover:text-red-300 h-8 w-8",onClick:()=>O(r.id),children:e.jsx(ge,{size:16})})]})]},r.id)),L.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:a?`No customers found for "${a}".`:"No customers found. Start by adding a customer!"})})]})]})})]})]})})};export{Ae as default};
